import{G as E,w as g,W as z,c as V,f as d,o as l,i as k,g as m,h as i,y as u,O as L,t as C,u as o,Q as v,n as b,x as B,P as M,J as A,S as f,I as N,X as U,Y as W,T as j,U as G,V as H}from"./index-BGCAAR9m.chunk.mjs";import{f as J,C as Q,a as X,c as Y}from"./Calendar-DT9LkGD1.chunk.mjs";import{l as D}from"./index-IgWYF-oH.chunk.mjs";import{u as P,s as F,L as K,C as Z,a as ee,b as te}from"./useAppointmentResponse-wi_dC-8i.chunk.mjs";import"./index-hZPKu-D6-BXEfvOYf.chunk.mjs";const ae={class:"appointment-item","data-test":"widget-appointment-item"},ne={key:0,class:"checkin-section"},se={class:"appointment-header"},ie={class:"appointment-time"},oe={class:"response-section"},ce={key:0,class:"comment-section"},le={class:"textarea-container"},re={key:0,class:"saving-spinner"},de={key:1,class:"saved-indicator"},me={key:2,class:"error-indicator"},pe={__name:"WidgetAppointmentItem",props:{item:{type:Object,required:!0},showCheckinButton:{type:Boolean,default:!1}},emits:["respond","open-checkin","open-detail"],setup(t){const c=t,s=g(!1),h=g(null),r=g(c.item.userResponse?.comment||"");let p=null;const{savingComment:x,commentSaved:R,errorComment:_,autoSaveComment:T}=P();z(()=>c.item.userResponse,a=>{p||(r.value=a?.comment||"")},{deep:!0});const $=async()=>{s.value=!s.value,s.value&&(await A(),h.value?.$el?.querySelector("input")?.focus())},S=()=>{p&&clearTimeout(p),p=setTimeout(async()=>{await A();const a=c.item.userResponse;a&&T(c.item.id,a.response,r.value),p=null},500)},I=V(()=>J(c.item.subText)),O=V(()=>F(c.item.description));return(a,n)=>(l(),d("div",ae,[t.showCheckinButton?(l(),d("div",ne,[i(o(v),{variant:"primary",class:"checkin-button","data-test":"button-widget-checkin",onClick:n[0]||(n[0]=e=>a.$emit("open-checkin",t.item.id))},{icon:u(()=>[i(K)]),default:u(()=>[L(" "+C(a.t("attendance","Start check-in")),1)]),_:1})])):k("",!0),m("div",se,[m("h3",{class:"clickable","data-test":"widget-appointment-title",onClick:n[1]||(n[1]=e=>a.$emit("open-detail",t.item.id))},C(t.item.mainText),1),m("span",ie,C(I.value),1)]),t.item.description?(l(),d("div",{key:1,class:"appointment-description clickable",onClick:n[2]||(n[2]=e=>a.$emit("open-detail",t.item.id))},C(O.value),1)):k("",!0),m("div",oe,[m("div",{class:b(["response-buttons",{"has-response":t.item.userResponse}])},[i(o(v),{class:b({active:t.item.userResponse?.response==="yes"}),variant:"success",text:a.t("attendance","Yes"),"data-test":"widget-response-yes",onClick:n[3]||(n[3]=e=>a.$emit("respond",t.item.id,"yes"))},null,8,["class","text"]),i(o(v),{class:b({active:t.item.userResponse?.response==="maybe"}),variant:"warning",text:a.t("attendance","Maybe"),"data-test":"widget-response-maybe",onClick:n[4]||(n[4]=e=>a.$emit("respond",t.item.id,"maybe"))},null,8,["class","text"]),i(o(v),{class:b({active:t.item.userResponse?.response==="no"}),variant:"error",text:a.t("attendance","No"),"data-test":"widget-response-no",onClick:n[5]||(n[5]=e=>a.$emit("respond",t.item.id,"no"))},null,8,["class","text"]),t.item.userResponse?(l(),B(o(v),{key:0,class:b({"comment-active":s.value,"comment-toggle":!0}),type:"tertiary","data-test":"button-widget-toggle-comment",onClick:$},{icon:u(()=>[i(Z,{size:14})]),_:1},8,["class"])):k("",!0)],2),s.value?(l(),d("div",ce,[m("div",le,[i(o(M),{ref_key:"commentInput",ref:h,modelValue:r.value,"onUpdate:modelValue":[n[6]||(n[6]=e=>r.value=e),S],type:"text",label:a.t("attendance","Comment (optional)"),placeholder:a.t("attendance","Add your comment …"),"data-test":"widget-response-comment"},null,8,["modelValue","label","placeholder"]),o(x)?(l(),d("div",re,[...n[7]||(n[7]=[m("div",{class:"spinner"},null,-1)])])):o(R)?(l(),d("div",de,[i(Q,{size:16,class:"check-icon"})])):o(_)?(l(),d("div",me,[i(ee,{size:16,class:"error-icon"})])):k("",!0)])])):k("",!0)])]))}},ue=E(pe,[["__scopeId","data-v-bc30fed1"]]),ve=["data-nc-version"],ge={class:"widget-footer"},he={__name:"Widget",props:{title:{type:String,required:!0}},setup(t){let c=[],s="ok",h=31;try{c=D("attendance","dashboard-widget-items")}catch(e){console.error("Error loading appointments:",e),s="error"}try{h=D("attendance","nc-version")}catch{console.debug("nc-version not available, defaulting to 31")}const r=g(c),p=g(s),x=g(h),{permissions:R,loadPermissions:_}=te(),{submitResponse:T}=P(),$=V(()=>r.value.map(e=>({id:e.id,mainText:e.name,subText:e.startDatetime,description:e.description,link:f("/apps/attendance"),iconUrl:f("/svg/attendance/calendar"),userResponse:e.userResponse}))),S=async(e,w)=>{try{await T(e,w,"");const y=r.value.findIndex(q=>q.id===e);y!==-1&&(r.value[y].userResponse={response:w,comment:""})}catch{}},I=()=>{window.location.href=f("/apps/attendance/")},O=e=>{window.location.href=f(`/apps/attendance/appointment/${e}`)},a=e=>R.canCheckin?Y(e.subText,30):!1,n=e=>{const w=f("/apps/attendance/checkin/{id}",{id:e});window.location.href=w};return N(async()=>{await _()}),(e,w)=>(l(),d("div",{class:"appointment-widget-container","data-nc-version":x.value,"data-test":"widget-container"},[i(o(W),{items:$.value,loading:p.value==="loading",class:"appointment-widget","data-test":"appointment-widget"},{"empty-content":u(()=>[i(o(U),{title:e.t("attendance","No appointments found")},{icon:u(()=>[i(X)]),_:1},8,["title"])]),default:u(({item:y})=>[i(ue,{item:y,"show-checkin-button":a(y),onRespond:S,onOpenCheckin:n,onOpenDetail:O},null,8,["item","show-checkin-button"])]),_:1},8,["items","loading"]),m("div",ge,[i(o(v),{variant:"primary",wide:"","data-test":"button-show-all",onClick:I},{default:u(()=>[L(C(e.t("attendance","Show all appointments")),1)]),_:1})])],8,ve))}},we=E(he,[["__scopeId","data-v-7c3c9c5b"]]);document.addEventListener("DOMContentLoaded",()=>{OCA.Dashboard.register("attendance-vue-widget",(t,{widget:c})=>{try{const s=j(we,{title:c.title});s.config.globalProperties.t=G,s.config.globalProperties.n=H,s.mount(t)}catch(s){console.error("Error creating/mounting Vue instance:",s),t.innerHTML='<div style="color: red;">Error loading widget: '+s.message+"</div>"}})});
//# sourceMappingURL=attendance-dashboard.mjs.map
