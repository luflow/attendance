import{x as _,o as c,y as o,g as n,h as s,t as l,u as i,H as J,G as X,w as d,I as Z,J as ee,f as w,K as h,L as D,F as P,i as T,M as H,O as R,P as K,Q as ae,R as C,S as G,T as te,U as ne,V as le}from"./index-BGCAAR9m.chunk.mjs";import{s as I,a as se}from"./index-hZPKu-D6-BXEfvOYf.chunk.mjs";import{N as L}from"./NcNoteCard-C6JdnZUp-DJ-IEcCg.chunk.mjs";import{A as W,a as B}from"./AccountStar-Cls1ZAmN.chunk.mjs";const de={style:{display:"flex","align-items":"center",gap:"8px"}},ie={style:{display:"flex","align-items":"center",gap:"8px"}},x={__name:"GroupSelect",props:{modelValue:{type:Array,default:()=>[]},options:{type:Array,default:()=>[]},placeholder:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(V){return(m,p)=>(c(),_(i(J),{"model-value":V.modelValue,options:V.options,placeholder:V.placeholder,multiple:!0,disabled:V.disabled,label:"displayName","track-by":"id","onUpdate:modelValue":p[0]||(p[0]=r=>m.$emit("update:modelValue",r))},{option:o(({displayName:r})=>[n("span",de,[s(W,{size:20}),n("span",null,l(r),1)])]),"selected-option":o(({displayName:r})=>[n("span",ie,[s(W,{size:16}),n("span",null,l(r),1)])]),_:1},8,["model-value","options","placeholder","disabled"]))}},oe={id:"attendance-admin-settings","data-test":"admin-settings"},re={key:0,class:"loading-section"},ce={class:"hint-text"},ue={style:{display:"flex","align-items":"center",gap:"8px"}},pe={style:{display:"flex","align-items":"center",gap:"8px"}},me={class:"hint-text"},ve={class:"subsection"},he={class:"subsection-hint"},ge={class:"hint-text"},ye={class:"subsection"},be={class:"subsection-hint"},fe={class:"hint-text"},we={class:"subsection"},Ve={class:"subsection-hint"},Se={class:"hint-text"},xe={class:"subsection"},_e={class:"subsection-hint"},ke={class:"hint-text"},Ee={class:"hint-text"},Ae={key:0,class:"reminder-config"},Ne={id:"calendar-sync"},Ie={class:"hint-text"},Ue={class:"hint-text"},Me={__name:"AdminSettings",setup(V){const m=d([]),p=d([]),r=d([]),k=d([]),U=d(!1),q=d(!1),g=d([]),y=d([]),b=d([]),f=d([]),S=d(!1),E=d(7),A=d(0),F=d(!0),N=d(!1),z=d(!1),u=d(!1),M=d(!0),Q=async()=>{M.value=!0;try{const e=await C.get(G("/apps/attendance/api/admin/settings"));e.data.success?(m.value=e.data.groups,p.value=e.data.whitelistedGroups.map(a=>e.data.groups.find(t=>t.id===a)).filter(a=>a!==void 0),q.value=e.data.teamsAvailable||!1,e.data.whitelistedTeams&&(r.value=e.data.whitelistedTeams,k.value=[...e.data.whitelistedTeams]),e.data.permissions&&(g.value=e.data.permissions.manage_appointments.map(a=>e.data.groups.find(t=>t.id===a)).filter(a=>a!==void 0),y.value=e.data.permissions.checkin.map(a=>e.data.groups.find(t=>t.id===a)).filter(a=>a!==void 0),b.value=(e.data.permissions.see_response_overview||[]).map(a=>e.data.groups.find(t=>t.id===a)).filter(a=>a!==void 0),f.value=(e.data.permissions.see_comments||[]).map(a=>e.data.groups.find(t=>t.id===a)).filter(a=>a!==void 0)),e.data.reminders&&(S.value=e.data.reminders.enabled||!1,E.value=e.data.reminders.reminderDays||7,A.value=e.data.reminders.reminderFrequency||0,F.value=e.data.reminders.notificationsAppEnabled!==!1),e.data.calendarSync&&(N.value=e.data.calendarSync.enabled||!1,z.value=e.data.calendarSync.available||!1)):I(window.t("attendance","Failed to load settings")+(e.data.error?": "+e.data.error:""))}catch(e){console.error("Error loading settings:",e),I(window.t("attendance","Failed to load settings"))}finally{M.value=!1}},Y=async e=>{if(!e||e.length<1){k.value=[...r.value];return}U.value=!0;try{const a=(await C.get(G("/apps/attendance/api/search/users-groups-teams"),{params:{search:e}})).data.filter(v=>v.type==="team").map(v=>({id:v.id,label:v.label,type:"team"})),t=r.value.map(v=>v.id),j=a.filter(v=>!t.includes(v.id));k.value=[...r.value,...j]}catch(a){console.error("Error searching teams:",a)}finally{U.value=!1}},$=async()=>{u.value=!0;try{const e=await C.post(G("/apps/attendance/api/admin/settings"),{whitelistedGroups:p.value.map(a=>a.id),whitelistedTeams:r.value.map(a=>a.id),permissions:{PERMISSION_MANAGE_APPOINTMENTS:g.value.map(a=>a.id),PERMISSION_CHECKIN:y.value.map(a=>a.id),PERMISSION_SEE_RESPONSE_OVERVIEW:b.value.map(a=>a.id),PERMISSION_SEE_COMMENTS:f.value.map(a=>a.id)},reminders:{enabled:S.value,reminderDays:E.value,reminderFrequency:A.value},calendarSync:{enabled:N.value}});e.data.success?se(window.t("attendance","Settings saved")):I(window.t("attendance","Failed to save settings")+(e.data.error?": "+e.data.error:""))}catch(e){console.error("Error saving settings:",e),I(window.t("attendance","Failed to save settings"))}finally{u.value=!1}};return Z(async()=>{if(await Q(),await ee(),window.location.hash){const e=document.querySelector(window.location.hash);e&&e.scrollIntoView({behavior:"smooth"})}}),(e,a)=>(c(),w("div",oe,[s(i(h),{name:e.t("attendance","Attendance"),description:e.t("attendance","Configure attendance management and reminders")},null,8,["name","description"]),M.value?(c(),w("div",re,[s(i(D),{size:32}),n("p",null,l(e.t("attendance","Loading settings …")),1)])):(c(),w(P,{key:1},[s(i(h),{name:e.t("attendance","Response summary groups"),description:e.t("attendance","Select which groups to include in response summaries. Users outside these groups will appear under Others. Leave empty to include all groups."),"data-test":"section-tracking-groups"},{default:o(()=>[s(x,{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=t=>p.value=t),options:m.value,placeholder:e.t("attendance","Select groups …"),disabled:u.value,"data-test":"select-whitelisted-groups"},null,8,["modelValue","options","placeholder","disabled"]),n("p",ce,l(e.n("attendance","%n group selected","%n groups selected",p.value.length,{n:p.value.length})),1)]),_:1},8,["name","description"]),q.value?(c(),_(i(h),{key:0,name:e.t("attendance","Response summary teams"),description:e.t("attendance","Select which teams to include in response summaries. Team members will be grouped together like regular groups."),"data-test":"section-tracking-teams"},{default:o(()=>[s(i(J),{modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=t=>r.value=t),options:k.value,placeholder:e.t("attendance","Search and select teams …"),multiple:!0,disabled:u.value,loading:U.value,filterable:!1,label:"label","track-by":"id","data-test":"select-whitelisted-teams",onSearch:Y},{option:o(({label:t})=>[n("span",ue,[s(B,{size:20}),n("span",null,l(t),1)])]),"selected-option":o(({label:t})=>[n("span",pe,[s(B,{size:16}),n("span",null,l(t),1)])]),_:1},8,["modelValue","options","placeholder","disabled","loading"]),n("p",me,l(e.n("attendance","%n team selected","%n teams selected",r.value.length,{n:r.value.length})),1)]),_:1},8,["name","description"])):T("",!0),s(i(h),{name:e.t("attendance","Permissions"),description:e.t("attendance","Configure which groups can perform specific actions. Users must belong to at least one of the selected groups to access the feature. If no group is selected, all users have access to the feature.")},{default:o(()=>[n("div",ve,[n("h4",null,l(e.t("attendance","Manage appointments")),1),n("p",he,l(e.t("attendance","Groups that can create, update, and delete appointments")),1),s(x,{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=t=>g.value=t),options:m.value,placeholder:e.t("attendance","Select groups …"),disabled:u.value,"data-test":"select-manage-appointments-roles"},null,8,["modelValue","options","placeholder","disabled"]),n("p",ge,l(e.n("attendance","%n group selected","%n groups selected",g.value.length,{n:g.value.length})),1)]),n("div",ye,[n("h4",null,l(e.t("attendance","Check-in access")),1),n("p",be,l(e.t("attendance","Groups that can access the check-in interface and execute check-ins")),1),s(x,{modelValue:y.value,"onUpdate:modelValue":a[3]||(a[3]=t=>y.value=t),options:m.value,placeholder:e.t("attendance","Select groups …"),disabled:u.value,"data-test":"select-checkin-roles"},null,8,["modelValue","options","placeholder","disabled"]),n("p",fe,l(e.n("attendance","%n group selected","%n groups selected",y.value.length,{n:y.value.length})),1)]),n("div",we,[n("h4",null,l(e.t("attendance","See response & check-in summary")),1),n("p",Ve,l(e.t("attendance","Groups that can see the response summary and check-in summary")),1),s(x,{modelValue:b.value,"onUpdate:modelValue":a[4]||(a[4]=t=>b.value=t),options:m.value,placeholder:e.t("attendance","Select groups …"),disabled:u.value,"data-test":"select-see-response-overview-roles"},null,8,["modelValue","options","placeholder","disabled"]),n("p",Se,l(e.n("attendance","%n group selected","%n groups selected",b.value.length,{n:b.value.length})),1)]),n("div",xe,[n("h4",null,l(e.t("attendance","See comments")),1),n("p",_e,l(e.t("attendance","Groups that can see comments in the response overview")),1),s(x,{modelValue:f.value,"onUpdate:modelValue":a[5]||(a[5]=t=>f.value=t),options:m.value,placeholder:e.t("attendance","Select groups …"),disabled:u.value,"data-test":"select-see-comments-roles"},null,8,["modelValue","options","placeholder","disabled"]),n("p",ke,l(e.n("attendance","%n group selected","%n groups selected",f.value.length,{n:f.value.length})),1)])]),_:1},8,["name","description"]),s(i(h),{name:e.t("attendance","Appointment reminders"),description:e.t("attendance","Send automatic reminder notifications to users who haven't responded to appointments.")},{default:o(()=>[F.value?(c(),w(P,{key:1},[s(i(H),{modelValue:S.value,"onUpdate:modelValue":a[6]||(a[6]=t=>S.value=t),type:"switch","data-test":"switch-reminders-enabled"},{default:o(()=>[R(l(e.t("attendance","Enable automatic reminders")),1)]),_:1},8,["modelValue"]),S.value?(c(),w("div",Ae,[s(i(K),{modelValue:E.value,"onUpdate:modelValue":a[7]||(a[7]=t=>E.value=t),modelModifiers:{number:!0},type:"number",label:e.t("attendance","Days before appointment"),"helper-text":e.t("attendance","Send reminders this many days before the appointment (1-30 days)"),"data-test":"input-reminder-days","input-props":{min:1,max:30}},null,8,["modelValue","label","helper-text"]),s(i(K),{modelValue:A.value,"onUpdate:modelValue":a[8]||(a[8]=t=>A.value=t),modelModifiers:{number:!0},type:"number",class:"reminder-frequency-field",label:e.t("attendance","Reminder frequency (days)"),"helper-text":e.t("attendance","How often to remind users who haven't responded. Set to 0 to only remind once, or 1-30 to repeat reminders every N days."),"data-test":"input-reminder-frequency","input-props":{min:0,max:30}},null,8,["modelValue","label","helper-text"])])):T("",!0)],64)):(c(),_(i(L),{key:0,type:"warning"},{default:o(()=>[n("p",null,l(e.t("attendance","The Notifications app is not enabled. Please enable it to use appointment reminders.")),1),n("p",Ee,l(e.t("attendance","You can enable it in the Apps section of your Nextcloud settings.")),1)]),_:1}))]),_:1},8,["name","description"]),n("div",Ne,[s(i(h),{name:e.t("attendance","Calendar sync"),description:e.t("attendance","Automatically update attendance appointments when their linked calendar events are modified.")},{default:o(()=>[z.value?(c(),w(P,{key:1},[s(i(H),{modelValue:N.value,"onUpdate:modelValue":a[9]||(a[9]=t=>N.value=t),type:"switch","data-test":"switch-calendar-sync-enabled"},{default:o(()=>[R(l(e.t("attendance","Enable automatic calendar sync")),1)]),_:1},8,["modelValue"]),n("p",Ue,l(e.t("attendance","When enabled, changes to calendar events will automatically update linked attendance appointments (title, description, date/time).")),1)],64)):(c(),_(i(L),{key:0,type:"warning"},{default:o(()=>[n("p",null,l(e.t("attendance","Calendar sync requires Nextcloud 32 or newer.")),1),n("p",Ie,l(e.t("attendance","This feature uses calendar event hooks that are only available in Nextcloud 32 and later versions.")),1)]),_:1}))]),_:1},8,["name","description"])]),s(i(h),null,{default:o(()=>[s(i(ae),{variant:"primary",disabled:u.value,"data-test":"button-save-settings",onClick:$},{icon:o(()=>[u.value?(c(),_(i(D),{key:0})):T("",!0)]),default:o(()=>[R(" "+l(e.t("attendance","Save")),1)]),_:1},8,["disabled"])]),_:1})],64))]))}},Pe=X(Me,[["__scopeId","data-v-a456cdab"]]),O=te(Pe);O.config.globalProperties.t=ne,O.config.globalProperties.n=le,O.mount("#attendance-admin-settings-vue");
//# sourceMappingURL=attendance-settings.mjs.map
